# 機能仕様書: Podcast UI編集・配信素材管理

**Feature ブランチ**: `001-podcast-ui-editor`  
**作成日**: 2026年2月15日  
**ステータス**: Draft  
**入力**: ユーザー説明: "Podcastの番組情報やチャンネル情報の編集、番組および各エピソードのアートワークの編集、音声アップロードをローカルアプリのUI上からできるようになる"

## Clarifications

### Session 2026-02-15

- Q: 新規エピソード作成はスコープに含めるか？ → A: 新規エピソード作成を含む（メタデータ＋音声アップロード）
- Q: ローカルUIのアクセス保護はどうするか？ → A: 起動時の簡易パスワード（.env で設定）
- Q: 取り込み・配信で許可するストレージは？ → A: RSSはR2のみ（GCSは利用しない）
- Q: RSS更新時の安全策はどうするか？ → A: 上書き前にRSSのバックアップを自動保存
- Q: プレビュー対象はどこまで含めるか？ → A: 番組説明とエピソード説明の両方

## ユーザーシナリオ & テスト（必須）

<!--
  重要: ユーザーストーリーは重要度順に優先順位を付けて記載する。
  各ストーリーは単独でテスト可能で、1つだけ実装しても MVP として価値があること。
  (P1, P2, P3...) の優先度を付与。
-->

### ユーザーストーリー1 - RSS取得と番組・エピソード編集（優先度: P1）

運用者は公開済みRSSフィードを読み込み、番組情報とエピソード情報をUI上で修正し、更新版を再公開できる。

**この優先度の理由**: 番組情報の正確性は配信の信頼性に直結し、修正頻度も高いため最優先。

**独立テスト**: RSS URLを入力し、編集と再公開まで完結できることを確認できる。

**受け入れシナリオ**:

1. **Given** 公開RSSのURLがある, **When** 運用者が読み込む, **Then** 番組情報とエピソード一覧が表示される
2. **Given** 番組情報またはエピソード情報を編集した, **When** 再公開を実行する, **Then** RSSが更新され公開先に反映される

---

### ユーザーストーリー2 - アートワークと音声の差し替え（優先度: P2）

運用者は番組および各エピソードのアートワークや音声ファイルを差し替え、必要に応じてRSSも更新できる。

**この優先度の理由**: 品質改善や修正版配信の要望が多く、視聴体験に影響するため高優先。

**独立テスト**: 任意のエピソードでアートワークと音声の差し替えを行い、反映を確認できる。

**受け入れシナリオ**:

1. **Given** 既存の番組またはエピソードがある, **When** 画像を差し替える, **Then** 新しい画像URLがRSSに反映される
2. **Given** 既存の音声がある, **When** 音声を差し替える, **Then** 置換結果と再生確認ができる
3. **Given** 番組が存在する, **When** 新規エピソードを作成して音声をアップロードする, **Then** エピソード一覧に追加されRSSに反映される

---

### ユーザーストーリー3 - 配信先表示のプレビュー（優先度: P3）

運用者は主要配信プラットフォームでの説明文の見え方を事前に確認できる。

**この優先度の理由**: 説明文の崩れやエスケープ問題を事前に回避できるが、公開自体は可能なためP3。

**独立テスト**: 任意の番組・エピソードでプレビューを表示できる。

**受け入れシナリオ**:

1. **Given** 説明文がある, **When** プレビューを開く, **Then** 各配信先向けの表示が確認できる
2. **Given** 番組説明とエピソード説明がある, **When** それぞれのプレビューを切り替える, **Then** 両方の表示が確認できる

---

[必要に応じてストーリーを追加]

### エッジケース

- RSSが取得できない、または形式が不正な場合は、原因が分かるエラーメッセージを表示する
- 画像・音声の差し替えに失敗した場合、元の状態を保持し再試行できる
- 音声差し替えでURLが変更された場合、RSSの該当エピソードに必ず反映される
- 大量エピソード（100件以上）でも一覧表示と検索が破綻しない

## 要件（必須）

### 機能要件

- **FR-001**: システムはCloudflare R2で公開されているRSSフィードを取得し、番組情報とエピソード情報を表示できなければならない
- **FR-002**: ユーザーは番組情報（タイトル、説明文、チャンネル情報）を編集し、更新版RSSとして再公開できなければならない
- **FR-003**: ユーザーはエピソード情報（タイトル、説明文、配信状態）を編集し、更新版RSSとして再公開できなければならない
- **FR-004**: ユーザーは番組およびエピソードのアートワークを差し替え、RSS内の画像URLを更新できなければならない
- **FR-005**: ユーザーはエピソードの音声ファイルを差し替え、必要に応じてRSS内の音声URLを更新できなければならない
- **FR-006**: システムは主要配信先向けの説明文プレビューを提供し、エスケープによる表示差分を確認できなければならない
- **FR-006a**: システムは番組説明とエピソード説明の両方についてプレビューを提供しなければならない
- **FR-007**: システムはRSSやメディアの更新に失敗した場合、失敗理由と再試行手段を提示しなければならない
- **FR-008**: システムは番組・エピソード一覧で検索やフィルタリングが行えるようにしなければならない
- **FR-009**: ユーザーは番組に対して新規エピソードを作成し、メタデータと音声をアップロードしてRSSに反映できなければならない
- **FR-010**: システムはRSSを上書きする前に自動でバックアップを保存し、必要に応じて復元できなければならない

### 前提・制約

- 単一の運用者がローカル環境で利用する運用を想定する
- 対象となるRSSとメディアはCloudflare R2で公開されているものに限定する
- 永続的な監査ログや複数人の承認ワークフローは対象外とする
- ローカルUIへのアクセスは起動時の簡易パスワードで保護する
- RSS取得・公開に利用するストレージはCloudflare R2に限定する

### 主要エンティティ（データを扱う場合）

- **Podcast**: 番組情報（タイトル、説明文、チャンネル情報、アートワークURL）
- **Episode**: エピソード情報（タイトル、説明文、配信状態、音声URL、アートワークURL）
- **RSS Feed**: 番組とエピソードの公開メタデータをまとめた配信情報
- **Media Asset**: アートワーク画像・音声ファイル
- **Distribution Preview**: 配信先ごとの説明文表示形式

## 成功基準（必須）

### 測定可能な成果

- **SC-001**: RSSの読み込みから番組情報の更新までを10分以内で完了できる
- **SC-002**: アートワークまたは音声の差し替えが95%以上のケースで初回の操作で成功する
- **SC-003**: プレビュー機能による表示崩れの事前検知率が80%以上になる
- **SC-004**: 手作業でのRSS編集工数が50%以上削減される
